<!DOCTYPE HTML>
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../../../../k2pmobile with footer(7-5-2013)/k2p19-2-13//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <link href="Styles/style.css" rel="stylesheet" type="text/css" />
    <!--<script type="text/javascript" src="js/jquery-1.4.2.js"></script>-->
    <script src="JS/jquery-1.8.3.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.Storage.js"></script>
    <script type="text/javascript" src="js/jquery.jsonp-2.1.3.min.js"></script>
    <script type="text/javascript">



        $(document).ready(function () {
            alert($('#txtEmail'));
            var online = navigator.onLine;    // Detecting the internet connection
            alert(online);
            if (online) {
                // do your stuff
            } else {
                alert('You\'re Offline now...');
                return false;
            }


            //            if ($.Storage.get("UserName") = "") {
            //                $.Storage.set("UserName", "");
            //            }



        });




        function UserLogin() {
//            alert("User LOgin");
//            alert(document.getElementById('txtEmail'));
//            alert($('#txtEmail').val());
//            alert($('#txtPassword').val());
            $.ajax({
                type: "POST",
                //url: "http://projectxmobile.2bvision.com/webservice.asmx/MobileAppGetSchoolUserByEmailAndPassword",
                url: "Webservice.asmx/MobileAppGetSchoolUserByEmailAndPassword",
                data: "{'email': '" + $('#txtEmail').val() + "','password':'" + $('#txtPassword').val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    //alert("Succesfully Login,,,,,");
                    if (response != null && response != "") {
                        var prods = response.d;
                        $("#Something").show();
                        $("#wraper").hide();
                        //alert("Wrapper hidden, showing Something.");
                        $.each(prods, function (index, prod) {
                            //alert("For each started");
                            var schooluserid = prod.SchoolUserId;
                            //alert("School User ID(abcd) :" + schooluserid);
                            //                            $.Storage.set("SchoolUserId", abcd.toString());
                            //                            var a = $.Storage.get("SchoolUserId");
                            //                            alert("SchoolUser ID123:" + a.toString());
                            var username = prod.FirstName + " " + prod.LastName;
                            //                            alert("Username123:" + username);
                            //                            $.Storage.set("SchoolUserName", username.toString());
                            //alert("School Code:" + prod.SchoolCode);
                            $.ajax({
                                type: "POST",
                                //url: "http://projectxmobile.2bvision.com/Webservice.asmx/GetSchools_SchoolCodeWise",
                                url: "Webservice.asmx/GetSchools_SchoolCodeWise",
                                data: "{'strSchoolCode': '" + prod.SchoolCode + "'}",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (response) {
                                    //alert("wao success.");
                                    if (response != null && response != "") {
                                        var prods = response.d;
                                        //$.Storage.set("SchoolId", prods.SchoolId);
                                        $("#Something").append("<a href='ataglance.html?value=" + prods.SchoolId + "&userId=" + schooluserid + "&username=" + username + "' style='font-size:18px'>" + prods.SchoolName + "</a>" + "<br/>");
                                        //alert("SchoolName::" + prods.SchoolName);
                                        return prods.SchoolName;
                                    }
                                    else {
                                        alert("No data to display");
                                        alert(response.d);
                                    }
                                },
                                error: function (e) {
                                    $("#Something").html("There was an error retrieving records12345." + "Error Description:  " + e.d);
                                }
                            });
                        });
                        //$("#wraper").hide();
                    }
                    else {
                        alert("No data to display");
                        alert(response.d);
                    }
                },
                error: function (e) {
                    alert("Login Failed,,,,,");
                    $("#Something").html("There was an error retrieving records." + "Error Description:  " + e.d);
                }
            });

            return false;
        }

        function GetSchoolNameBySchoolCode(code) {
            $.ajax({
                type: "POST",
                //url: "http://projectx.2bvision.com/WebCommunicator/Webservice.asmx/GetSchoolUserByEmailAndPassword",
                url: "Webservice.asmx/GetSchools_SchoolCodeWise",
                data: "{'strSchoolCode': '" + code + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response != null && response != "") {
                        var prods = response.d;
                        //alert(prods.SchoolName);
                        return prods.SchoolName;
                    }
                    else {
                        alert("No data to display");
                        alert(response.d);
                    }
                },
                error: function (e) {
                    $("#Something").html("There was an error retrieving records." + "Error Description:  " + e.d);
                }
            });


        }

        function AuthenticateSoapHeader() {
            $.ajax({
                type: "POST",
                url: "Webservice.asmx/AuthenticateSoapHeader",
                //data: "{'email': '" + $('#txtEmail').val() + "','password':'" + $('#txtPassword').val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response != null && response != "") {
                        alert(response.d);
                    }
                    else {
                        alert("No data to display");
                        alert(response.d);
                    }
                },
                error: function (e) {
                    $("#Something").html("There was an error retrieving records." + "Error Description:  " + e.d);
                }
            });


        }

        function Encrypt(password) {
            $.ajax({
                type: "POST",
                url: "Webservice.asmx/Encrypt",
                data: "{'text':'" + password + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response != null && response != "") {
                        alert(response.d);
                        //                        var prods = response.d;
                        //                        $.each(prods, function (index, prod) {
                        //                            $("#Something").append("<strong>" + prod.SchoolCode + "</strong>" + "<br/>");
                        //                        });
                    }
                    else {
                        alert("No data to display");
                        alert(response.d);
                    }
                },
                //                success: function (list) {
                //                    $("#Something").append("<ul id='bullets'></ul>");
                //                    for (i = 0; i < 5; i++) {
                //                        $("#bullets").append("<li>" + i + "</li>");
                //                    }
                //                },
                error: function (e) {
                    $("#Something").html("There was an error retrieving records." + "Error Description:  " + e.d);
                }
            });


        }


        
    </script>
    <script type="text/javascript">
        function asd() {
            var thing = { plugin: 'jquery-json', version: 2.3 };

            var encoded = $.toJSON(thing);
            // '{"plugin":"jquery-json","version":2.3}'
            var name = $.evalJSON(encoded).plugin;
            // "jquery-json"
            var version = $.evalJSON(encoded).version;
            // 2.3
            sessionStorage.setitem("name", "value");
            // alert(sessionStorage.getitem("name"));
        }
    </script>
    <script type="text/javascript">
        function ShowResult() {
            alert(event.result.value);
        }
    </script>
</head>
<body>
    <div id="Something" class="schoolsList" style="display: none;">
        <span style="">You are member of the following Businesses. Please select a Business
            for which you want to be logged in.</span><br />
    </div>
    <div id="wraper">
        <!-- container starts-->
        <div class="contetns">
            <!-- login -->
            <div class="loginWrap">
                <div class="loginWrap">
                    <!-- tabs-->
                    <div class="loginTabs">
                        <a href="login.htm">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Login</a>
                    </div>
                    <!-- input -->
                    <div class="clear">
                        <div class="loginMiddle">
                            <div class="row newuser">
                                Please enter your username and password. if you don't have an account.
                            </div>
                            <div class="errorLogin">
                                <label id="lblEror">
                                </label>
                            </div>
                            <div class="clearfix">
                            </div>
                            <div class="line">
                            </div>
                            <div class="row clearfix">
                                <label>
                                    User Name:</label>
                                <input id="txtEmail" class="inputBox" type="text" placeholder="Enter username here"
                                    tabindex="1" size="50" maxlength="60" name="txtEmail" />
                            </div>
                            <div class="row clearfix">
                                <label>
                                    Password:</label>
                                <input id="txtPassword" class="inputBox" type="password" placeholder="Enter password here"
                                    tabindex="1" size="20" maxlength="15" name="txtPassword" />
                            </div>
                            <div class="line">
                            </div>
                            <div class="row newuser clearfix">
                                <a href="">Forgot your password?</a>
                                <input id="submit" class="btn fRight" type="submit" tabindex="3" onclick="UserLogin()"
                                    name="submit" value="Login" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- container ends-->
    </div>
</body>
</html>
